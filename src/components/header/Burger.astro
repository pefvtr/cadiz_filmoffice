---
interface Props {
  classNames?: string;
}

const { classNames = "" } = Astro.props;
---

<div class="text relative">
  <div class="menu-text absolute">menu</div>
  <div
    class="close-text invisible absolute translate-y-[25%] rotate-[7deg] opacity-0"
  >
    cerrar
  </div>
</div>
<div class:list={["burger-icon", classNames]}>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
  <span></span>
</div>

<style>
  .burger-icon {
    width: 20px; /* Reducido de 35px a 20px */
    height: 17.14px; /* 30px * (20/35) ≈ 17.14px */
    position: relative;
    cursor: pointer;
    transform: rotate(0deg);
    transition: transform 0.2s ease-out; /* Añade esta línea */
    & span {
      display: block;
      position: absolute;
      height: 1.71px; /* 3px * (20/35) ≈ 1.71px */
      width: 50%;
      background: var(--color-primary);
      opacity: 1;
      -webkit-transform: rotate(0deg);
      -moz-transform: rotate(0deg);
      -o-transform: rotate(0deg);
      transform: rotate(0deg);
      -webkit-transition: 0.25s ease-in-out;
      -moz-transition: 0.25s ease-in-out;
      -o-transition: 0.25s ease-in-out;
      transition: 0.25s ease-in-out;
      border-radius: 0.86px; /* 1.5px * (20/35) ≈ 0.86px */
    }

    &:hover span {
      background: var(--color-primary-dark);
    }
  }

  .burger-icon:hover:not(.open) {
    transform: rotate(90deg);
  }

  .burger-icon.open:hover {
    transform: rotate(90deg);
  }

  .burger-icon span:nth-child(even) {
    left: 50%;
    border-radius: 0 1.71px 1.71px 0; /* 3px * (20/35) ≈ 1.71px */
  }

  .burger-icon span:nth-child(odd) {
    left: 0px;
    border-radius: 1.71px 0 0 1.71px; /* 3px * (20/35) ≈ 1.71px */
  }

  /* SEPARACIÓN EQUIDISTANTE - recalculada proporcionalmente */
  .burger-icon span:nth-child(1),
  .burger-icon span:nth-child(2) {
    top: 3.43px; /* 6px * (20/35) ≈ 3.43px */
  }

  .burger-icon span:nth-child(3),
  .burger-icon span:nth-child(4) {
    top: 8.57px; /* 15px * (20/35) ≈ 8.57px */
  }

  .burger-icon span:nth-child(5),
  .burger-icon span:nth-child(6) {
    top: 13.71px; /* 24px * (20/35) ≈ 13.71px */
  }

  /* TRANSFORMACIÓN PARA FORMAR UNA SOLA X - recalculado */
  .burger-icon.open span:nth-child(1) {
    top: 8.57px; /* Centro exacto (15px * (20/35) ≈ 8.57px) */
    left: 0px;
    width: 100%;
    transform: rotate(45deg);
  }

  .burger-icon.open span:nth-child(2) {
    top: 8.57px; /* Mismo centro */
    left: 0px;
    width: 100%;
    transform: rotate(-45deg);
  }

  /* Barras del medio desaparecen hacia los lados */
  .burger-icon.open span:nth-child(3) {
    left: -50%;
    opacity: 0;
  }

  .burger-icon.open span:nth-child(4) {
    left: 100%;
    opacity: 0;
  }

  /* Barras inferiores desaparecen */
  .burger-icon.open span:nth-child(5),
  .burger-icon.open span:nth-child(6) {
    opacity: 0;
    width: 0%;
  }
</style>

<script>
  import { gsap } from "gsap";

  document.addEventListener("astro:page-load", () => {
    const burgerIcon = document.querySelector(".burger-icon") as HTMLDivElement;
    const menuText = document.querySelector(".menu-text") as HTMLDivElement;
    const closeText = document.querySelector(".close-text") as HTMLDivElement;
    const text = document.querySelector(".text") as HTMLDivElement;
    let tl = gsap.timeline();
    let isOpen = false;

    burgerIcon.addEventListener("click", (e) => {
      const target = e.currentTarget as HTMLDivElement;
      target.classList.toggle("open");

      isOpen = target.classList.contains("open");

      // Limpiar/controlar la timeline
      tl.clear(); // Limpia animaciones anteriores
      tl.kill(); // Mata la animación actual si está en progreso

      // Reiniciar timeline
      tl = gsap.timeline();

      if (isOpen) {
        // Para OCULTAR: anima DESDE el estado visible HACIA oculto
        tl.to(menuText, {
          duration: 1,
          y: "-25%",
          rotate: "-7deg",
          autoAlpha: 0,
        }).to(
          closeText,
          {
            duration: 1,
            y: "0%",
            rotate: "0deg",
            autoAlpha: 1,
          },
          "-=0.5", // Superponer la animación de mostrar con la de ocultar
        );
      } else {
        // Para MOSTRAR: primero hacer visible, luego animar
        tl.to(
          closeText,
          {
            duration: 1,
            y: "25%",
            rotate: "7deg",
            autoAlpha: 0,
          }, // Superponer la animación de ocultar con la de mostrar
        ).to(
          menuText,
          {
            duration: 1,
            y: "0%",
            rotate: "0deg",
            autoAlpha: 1,
          },
          "-=0.5",
        );
      }
    });

    // burgerIcon.addEventListener("click", (e) => {
    //   const target = e.currentTarget as HTMLDivElement;
    //   target.classList.toggle("open");

    //   isOpen = target.classList.contains("open");

    //   if (isOpen) {
    //     console.log("Abriendo menú");

    //     tl.fromTo(
    //       menuText,
    //       {
    //         y: "0%",
    //         rotate: "0deg",
    //         opacity: 1,
    //         visibility: "visible",
    //       },
    //       {
    //         duration: 1,
    //         y: "-25%",
    //         rotate: "-7deg",
    //         opacity: 0,
    //         visibility: "hidden",
    //       },
    //     );
    //   } else {
    //     console.log("Cerrando menú");
    //     tl.fromTo(
    //       menuText,
    //       {
    //         y: "-25%",
    //         rotate: "-7deg",
    //         opacity: 0,
    //         visibility: "hidden",
    //       },
    //       {
    //         duration: 1,
    //         y: "0%",
    //         rotate: "0deg",
    //         opacity: 1,
    //         visibility: "visible",
    //       },
    //     );
    //   }
    // });
  });
</script>
